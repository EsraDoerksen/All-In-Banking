<html>
  <body>
    <h1>Hier ist der Outer IFframe.</h1>
    Er l√§dt den inneren mit der AppId aus der Query.
    <br />
    <div id="iframe"></div>
  </body>
  <script>
    async function init() {
      // const response = await fetch(
      //   'https://dev-o8lopd1x78xgb35o.us.auth0.com/authorize?client_id=1IOUcn5eG1ZTrI8DJ9V4690c8T40NK3U&redirect_uri=http%3A%2F%2Flocalhost%3A3001&response_type=code&scope=openid%20profile%20email%20offline_access',
      //   { credentials: 'include' },
      // );
      // console.log(response.headers.get('location'));

      const urlParams = new URLSearchParams(window.location.search);
      const code = urlParams.get('code');
      if (!code) {
        const appId = urlParams.get('appId');
        window.sessionStorage.setItem('appId', appId);
        window.location.href =
          'https://dev-o8lopd1x78xgb35o.us.auth0.com/authorize?client_id=1IOUcn5eG1ZTrI8DJ9V4690c8T40NK3U&redirect_uri=http%3A%2F%2Flocalhost%3A3001&response_type=code&scope=openid%20profile%20email%20offline_access';
      }

      const data = new URLSearchParams();
      data.append('grant_type', 'authorization_code');
      data.append('client_id', '1IOUcn5eG1ZTrI8DJ9V4690c8T40NK3U');
      data.append('code', code);
      data.append('redirect_uri', 'http://localhost:3001');

      const result = await fetch(
        'https://dev-o8lopd1x78xgb35o.us.auth0.com/oauth/token',
        {
          method: 'post',
          body: data,
        },
      );
      const { id_token } = await result.json();
      console.log(id_token);

      const appId = window.sessionStorage.getItem('appId');
      const iframe = document.createElement('iframe');
      iframe.setAttribute('src', 'http://localhost:3001/apps/' + appId);
      document.getElementById('iframe').appendChild(iframe);
    }

    init();
  </script>
</html>
